<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="regnlog">
	<insert id="setEmpOne" parameterType="employeevo">
		<selectKey keyProperty="ref" order="BEFORE" resultType="int">
			SELECT IFNULL( max(emp_id) + 1 , 1 ) FROM employee
		</selectKey>
		INSERT INTO employee SET
			emp_department 		= #{empDepartment},
			emp_position 		= #{empPosition},
			emp_num 			= CONCAT(#{empNum},#{ref}),
			emp_enter 			= #{empEnter},
			emp_name 			= #{empName},
			emp_birth 			= #{empBirth},
			emp_password 		= #{empPassword},
			emp_email 			= #{empEmail}, 
			emp_step 			= #{empStep}, 
			emp_off_total 		= #{empOffTotal}, 
			emp_off_remain 		= #{empOffRemain}, 
			emp_regdate 		= now()
	</insert>



	<select id="getLoginInfo" parameterType="hashmap" resultType="employeevo">
		select 
			emp_id 			AS empId, 
			emp_confirm 	AS empConfirm, 
			emp_department 	AS empDepartment, 
			depart_name 	AS empDepartmentName, 
			emp_position 	AS empPosition, 
			position_name 	AS empPositionName, 
			emp_headcheck 	AS empHeadcheck, 
			emp_team 		AS empTeam, 
			emp_num 		AS empNum,
			emp_name		AS empName, 
			emp_auth 		AS empAuth, 
			emp_email 		AS empEmail, 
			emp_photo 		AS empPhoto 
		FROM employee 	LEFT JOIN department ON emp_department = depart_code 
						LEFT JOIN position ON emp_position = position_code 
						LEFT JOIN employee_detail ON emp_id = emp_id_fk 
						WHERE emp_num = #{empNum} AND emp_password = #{empPassword} 
	</select>
	<select id="getLoginConfirm" parameterType="hashmap" resultType="int">
		SELECT COUNT(*) FROM employee WHERE emp_id=#{empId} AND emp_confirm='N'
	</select>
	<select id="empNumChk" parameterType="hashmap" resultType="employeevo">
		SELECT emp_num AS empNum FROM employee WHERE emp_name = #{emp_name} AND emp_birth = #{emp_birth}
	</select>
	<select id="empPasswordChkCnt" parameterType="hashmap" resultType="int">
		SELECT COUNT(*) FROM employee WHERE emp_num = #{emp_num} AND emp_birth = #{emp_birth}
	</select>
	<update id="empPasswordChk" parameterType="hashmap">
		UPDATE employee SET emp_password = #{emp_password} WHERE emp_num = #{emp_num} AND emp_birth = #{emp_birth}
	</update>

</mapper>