<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="produce">

	<sql id="searchCondition">
		<choose>
			<when test="words == ''"></when>
			<otherwise>
				AND ${searchOpt} LIKE CONCAT('%', #{words}, '%') 
			</otherwise>
		</choose>
	</sql>

	<insert id="setProduceOne" parameterType="hashmap">
		${str}
	</insert>

	<select id="getProduceOne" parameterType="hashmap" resultType="producevo">
		SELECT 
			prod_id 			AS prodId,
			prod_p_name 		AS prodPName, 
			prod_p_unit 		AS prodPUnit, 
			prod_p_amount 		AS prodPAmount, 
			prod_doc_num_fk 	AS prodDocNumFk,
			prod_process_name1 	AS prodProcessName1, 
			prod_process1 		AS prodProcess1,
			prod_process_name2 	AS prodProcessName2, 
			prod_process2 		AS prodProcess2,
			prod_process_name3 	AS prodProcessName3, 
			prod_process3 		AS prodProcess3,
			prod_process_name4 	AS prodProcessName4, 
			prod_process4 		AS prodProcess4,
			prod_process_name5 	AS prodProcessName5, 
			prod_process5 		AS prodProcess5,
			prod_release 		AS prodRelease,
			prod_process_cnt 	AS prodProcessCnt 
		FROM produce WHERE prod_doc_num_fk = #{contDocNum}
	</select>
	<select id="getQcInfo" parameterType="int" resultType="producevo">
		SELECT 
			prod_id 			AS prodId,
			prod_p_name 		AS prodPName, 
			prod_p_unit 		AS prodPUnit, 
			prod_p_amount 		AS prodPAmount, 
			prod_doc_num_fk 	AS prodDocNumFk,
			prod_process_name1 	AS prodProcessName1, 
			prod_process1 		AS prodProcess1,
			prod_process_name2 	AS prodProcessName2, 
			prod_process2 		AS prodProcess2,
			prod_process_name3 	AS prodProcessName3, 
			prod_process3 		AS prodProcess3,
			prod_process_name4 	AS prodProcessName4, 
			prod_process4 		AS prodProcess4,
			prod_process_name5 	AS prodProcessName5, 
			prod_process5 		AS prodProcess5,
			prod_release 		AS prodRelease,
			prod_process_cnt 	AS prodProcessCnt 
		FROM produce WHERE prod_id = ${prodId}
	</select>
	<select id="getReleaseListCnt" resultType="int">
		SELECT COUNT(*) FROM produce WHERE prod_release = 'Y' <include refid="searchCondition"></include>
	</select>
	<select id="getReleaseList" resultType="produceVO">
		SELECT 
			prod_doc_num_fk 			AS prodDocNumFk,
			cont_client_company 		AS prodClientCompany, 
			cont_depart_name 			AS prodDepartmentName,
			cont_emp_name 				AS prodEmpName,
			cont_position_name  		AS prodPositionName,
			cont_client_responsibility 	AS prodClientResponsibility,
			cont_client_res_cp 			AS prodClientResCP,
			prod_p_name 				AS prodPName, 
			prod_p_unit 				AS prodPUnit, 
			prod_p_amount 				AS prodPAmount, 
			cont_orderDate 				AS prodOrderDate,
			cont_dueDate 				AS prodDueDate 
		FROM produce LEFT JOIN contract ON cont_doc_num = prod_doc_num_fk 
		WHERE prod_release = 'Y' <include refid="searchCondition"></include> 
		LIMIT ${startIndex}, ${pageSize}
	</select>
	
	<update id="updateQcOne" parameterType="hashmap">
		UPDATE produce SET ${prod_process} = #{prodValue} WHERE prod_id = ${prodId}
	</update>
	<update id="updateProdRelease" parameterType="hashmap">
		UPDATE produce SET prod_release = #{updateRelease} WHERE prod_id = ${prodId}
	</update>
	
	<delete id="delProduceOne" parameterType="hashmap">
		DELETE FROM produce WHERE prod_doc_num_fk = #{contDocNum}
	</delete>
</mapper>